

<!DOCTYPE html>
<html class="writer-html5" lang="ZH-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>117 孩子公众场合闹该怎么治 &mdash; lzk365 0.1 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="118 如何拒绝总是推荐私教课" href="c12_08.html" />
    <link rel="prev" title="116 应对网络杠精的有效建议" href="c12_06.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> lzk365
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p01.html">第一章：1-10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p02.html">第二章：11-20</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p03.html">第三章：21-30</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p04.html">第四章：31-40</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p05.html">第五章：41-50</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p06.html">第六章：51-60</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p07.html">第七章：61-70</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p08.html">第八章：71-80</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p09.html">第九章：81-90</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p10.html">第十章：91-100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p11.html">第十一章：101-110</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../chapters/p12.html">第十二章：111-120</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="c12_01.html">111 回应工作计划的6步模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_02.html">112 摆脱总受欺负的3条建议</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_03.html">113 城府极深的5种特征</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_04.html">114 虚伪的人的3种特征</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_05.html">115 这4种情况该翻脸就翻脸</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_06.html">116 应对网络杠精的有效建议</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">117 孩子公众场合闹该怎么治</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-pdm">1. Why PDM？</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdm">2. 安装 PDM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">3. 初始化 PDM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">4. PDM 用法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">4.1 安装包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">4.2 查看包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">4.3 删除包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">4.4 项目配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">4.5 运行命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">4.6 查看环境</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">4.7 更新包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#py">4.8 切换 py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id11">5. 命令别名</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">6. 自动补全</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">7. 方案兼容</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">其他方案迁移到 pdm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">pdm 迁移到其他方案</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id16">8. 总结一下</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="c12_08.html">118 如何拒绝总是推荐私教课</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_09.html">119 让男友放弃游戏陪你逛街</a></li>
<li class="toctree-l2"><a class="reference internal" href="c12_10.html">120 回应领导问对某人的看法</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p13.html">第十三章：121-130</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p14.html">第十四章：131-140</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p15.html">第十五章：141-150</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p16.html">第十六章：151-160</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p17.html">第十七章：161-170</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p18.html">第十八章：171-180</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p19.html">第十九章：181-190</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p20.html">第二十章：191-200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p21.html">第二十一章：201-210</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p22.html">第二十二章：211-220</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p23.html">第二十三章：221-230</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p24.html">第二十四章：231-240</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p25.html">第二十五章：241-250</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p26.html">第二十六章：251-260</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p27.html">第二十七章：261-270</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p28.html">第二十八章：271-280</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p29.html">第二十九章：281-290</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p30.html">第三十章：291-300</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p31.html">第三十一章：301-310</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p32.html">第三十二章：311-320</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p33.html">第三十三章：321-330</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p34.html">第三十四章：331-340</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p35.html">第三十五章：341-350</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p36.html">第三十六章：351-360</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p37.html">第三十六章：361-365</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lzk365</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../chapters/p12.html">第十二章：111-120</a> &raquo;</li>
        
      <li>117 孩子公众场合闹该怎么治</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/c12/c12_07.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="id1">
<h1>117 孩子公众场合闹该怎么治<a class="headerlink" href="#id1" title="此标题的永久链接">¶</a></h1>
<p>PDM 是一个新的 Python 的包管理器，也许你还未知晓它的存在，但实际上PDM
已经诞生两年，并在 2021 年发布 1.0 版本，目前最高的版本是 1.12.8。</p>
<p>在刚听到 PDM 时，我下意识认为它是 Python Development Manager，又一个和
Pipenv 和 Poetry 一样换汤不换药的虚拟环境管理工具。</p>
<p>一直到我翻到了作者的博客，才知道 PDM 的全称是 Python Development
Master，比我想像的还要牛逼一个档次。</p>
<p>值得一提的是，PDM 的作者是 PyPa 成员、Pipenv
目前主要的维护者之一，最重要的是，是他是中国人，因此这是一款国人开发的工具。</p>
<section id="why-pdm">
<h2>1. Why PDM？<a class="headerlink" href="#why-pdm" title="此标题的永久链接">¶</a></h2>
<p>早期的包管理器（如
Pipevn，Poetry），都是基于虚拟环境的，虚拟环境主要是为了隔离项目开发环境，但如果涉及到虚拟
环境嵌套虚拟环境，问题就难搞了，经常会出现问题。</p>
<p>PDM 得益于一个 2018 年的 PEP 提案（PEP582，Python local packages
directory），完全摒弃了虚拟环境。</p>
<p>从<a class="reference external" href="https://frostming.com/2020/02-28/pdm-introduction/">作者的博客</a>上来看，当初之所以要重复造个轮子，完全是因为
Pipenv 和 Poetry 都不够好用，正好有 PEP582 ，可以开发一个划时代的 Python
包管理工具，它就是 PDM 。</p>
<p>PDM 包含如下特性：</p>
<ul class="simple">
<li><p>PEP 582
本地项目库目录，支持安装与运行命令，<strong>完全不需要虚拟环境</strong>。</p></li>
<li><p>一个简单且相对快速的依赖解析器，特别是对于大的二进制包发布。</p></li>
<li><p>兼容 PEP 517 的构建后端，用于构建发布包(源码格式与 wheel 格式)</p></li>
<li><p>拥有灵活且强大的插件系统（有插件系统直接就拉开一个档次）</p></li>
<li><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0621">PEP 621</a> 元数据格式</p></li>
<li><p>像
<a class="reference external" href="https://pnpm.io/motivation#saving-disk-space-and-boosting-installation-speed">pnpm</a>
一样的中心化安装缓存，节省磁盘空间</p></li>
</ul>
<p>尽管 PDM 是国人开发，但考虑到国际化，官网文档是全英文的。</p>
<p>我花了整整一天，通读完文档，消化了 70% 的 PDM
用法，现将心得整理分享出来，会对你上手 PDM 有帮助。</p>
<p>关于 PDM，内容挺多的，打算分两篇文章来完整地介绍它：</p>
<ul class="simple">
<li><p>面向新手的入门级教程</p></li>
<li><p>面向骨灰级选手的教程</p></li>
</ul>
<p>本篇是第一篇，先让大家对 pdm 的基本用法有一个框架性的理解，而 pdm
真正竞争力请持续关注后续文章。</p>
</section>
<section id="pdm">
<h2>2. 安装 PDM<a class="headerlink" href="#pdm" title="此标题的永久链接">¶</a></h2>
<p>PDM 的安装方法有很多种，在官网上就有 6 种，比如 pip、pipx、homebrew 等</p>
<p>在以前的文章中，我推荐过 pipx 工具，在安装那种命令行应用的包时非常好用。</p>
<p>而此时 PDM 就是一个命令行工具，因此我也推荐使用 pipx
安装，方便统一对命令行进行管理</p>
<p>执行 pipx install pdm 即可安装</p>
<img alt="http://image.iswbm.com/image-20220212200413787.png" src="http://image.iswbm.com/image-20220212200413787.png" />
<p>PDM 只有 Python 3.7+ 的版本才能使用，使用其他的方法安装，要先保证你的
Python 版本，但使用 pipx 则不需要你去操心。</p>
</section>
<section id="id2">
<h2>3. 初始化 PDM<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h2>
<p>执行 pdm init 就会开始初始化，初始化的时候，会让你选择项目的一些信息</p>
<ul class="simple">
<li><p>是否要上传 PyPI</p></li>
<li><p>依赖的 Python 版本</p></li>
<li><p>License 类型</p></li>
<li><p>作者信息</p></li>
<li><p>邮箱信息</p></li>
</ul>
<p>我机器上有 Python 2.7 和 Python 3.10
两个版本，在初始化项目时会把机器上的所有 Python
版本都扫描出来了，会让选择项目的 Python 版本。</p>
<img alt="http://image.iswbm.com/image-20220212204609288.png" src="http://image.iswbm.com/image-20220212204609288.png" />
<p>完成之后，PDM 会将你的选择以 toml 格式写入 pyproject.toml 配置文件中。</p>
<img alt="http://image.iswbm.com/image-20220212204627731.png" src="http://image.iswbm.com/image-20220212204627731.png" />
</section>
<section id="id3">
<h2>4. PDM 用法<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h2>
<p>pdm 有非常多的命令，使用 <code class="docutils literal notranslate"><span class="pre">-h</span></code> 可以看到帮助菜单</p>
<img alt="http://image.iswbm.com/image-20220212204708840.png" src="http://image.iswbm.com/image-20220212204708840.png" />
<section id="id4">
<h3>4.1 安装包<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h3>
<p>和 Poetry 一样，安装使用的是 add 命令，但 pdm 的 add 比 poetry
好用，主要体现在分组，具体请关注后续文章</p>
<img alt="http://image.iswbm.com/image-20220212205148934.png" src="http://image.iswbm.com/image-20220212205148934.png" />
</section>
<section id="id5">
<h3>4.2 查看包<a class="headerlink" href="#id5" title="此标题的永久链接">¶</a></h3>
<p>使用 pdm list 可以以列表形式列出当前环境已安装的包</p>
<img alt="http://image.iswbm.com/image-20220212205220953.png" src="http://image.iswbm.com/image-20220212205220953.png" />
<p>再加个 <code class="docutils literal notranslate"><span class="pre">--graph</span></code>
就能以树状形式查看，直接依赖包和间接依赖包关系的层级一目了然</p>
<img alt="http://image.iswbm.com/image-20220212222032290.png" src="http://image.iswbm.com/image-20220212222032290.png" />
<p>pdm list 还有两个选项：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--freeze</span></code>：以 requirements.txt 的格式列出已安装的包</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--json</span></code>：以 json 的格式列出已安装的包，但必须与 <code class="docutils literal notranslate"><span class="pre">--graph</span></code>
同时使用</p></li>
</ul>
<p>要查看某个包的某体详情，直接用 pdm show 即可</p>
<img alt="http://image.iswbm.com/image-20220212211203788.png" src="http://image.iswbm.com/image-20220212211203788.png" />
</section>
<section id="id6">
<h3>4.3 删除包<a class="headerlink" href="#id6" title="此标题的永久链接">¶</a></h3>
<p>删除包使用的是 remove 命令</p>
<img alt="http://image.iswbm.com/image-20220212215831751.png" src="http://image.iswbm.com/image-20220212215831751.png" />
</section>
<section id="id7">
<h3>4.4 项目配置<a class="headerlink" href="#id7" title="此标题的永久链接">¶</a></h3>
<p>不加任何参数，可以打印出该项目的环境配置</p>
<img alt="http://image.iswbm.com/image-20220212211303563.png" src="http://image.iswbm.com/image-20220212211303563.png" />
<p>想要修改的话，只要加 key 和 value 做为参数即可，以修改 pypi 镜像代理为例</p>
<p>原来上面是豆瓣源，现在我要改成阿里源，只需要执行如下命令，可比 poetry
方便多啦～</p>
<img alt="http://image.iswbm.com/image-20220212212225849.png" src="http://image.iswbm.com/image-20220212212225849.png" />
<p>pdm config
里面有非常多的配置，想要一一搞清楚的可以去官网查阅：<a class="reference external" href="https://pdm.fming.dev/configuration/">https://pdm.fming.dev/configuration/</a></p>
</section>
<section id="id8">
<h3>4.5 运行命令<a class="headerlink" href="#id8" title="此标题的永久链接">¶</a></h3>
<p>想要在 pdm 的环境中执行命令或者项目，可以使用 run
命令，若是执行项目时，有诸多参数，可以在 pyproject.toml
配置命令别名，具体用法，请往后看</p>
<img alt="http://image.iswbm.com/image-20220212211033303.png" src="http://image.iswbm.com/image-20220212211033303.png" />
</section>
<section id="id9">
<h3>4.6 查看环境<a class="headerlink" href="#id9" title="此标题的永久链接">¶</a></h3>
<p>使用 <code class="docutils literal notranslate"><span class="pre">info</span></code> 命令，可以查看当前项目的环境信息</p>
<img alt="http://image.iswbm.com/image-20220212223811269.png" src="http://image.iswbm.com/image-20220212223811269.png" />
</section>
<section id="id10">
<h3>4.7 更新包<a class="headerlink" href="#id10" title="此标题的永久链接">¶</a></h3>
<p>更新的话，简单的场景下，使用下面这两条即可</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 更新所有包</span>
pdm<span class="w"> </span>update

<span class="c1"># 更新某个包</span>
pdm<span class="w"> </span>update<span class="w"> </span>&lt;pkg&gt;
</pre></div>
</div>
<p>复杂的场景，pdm
也都为你考虑到了，它提供了很多选项，可以根据需要使用（以下如有解释错误，请帮忙指正）</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--save-compatible</span></code>：项目依赖可兼容的版本</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--save-wildcard</span></code>：保存通配符版本（暂不明白）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--save-exact</span></code>：保存有指定确切版本的包</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--save-minimum</span></code>：保持最小版本的包</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--update-reuse</span></code>：尽量只更新命令行中指定的包，其依赖包能不更新则不更新</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--update-eager</span></code>：更新某个包顺带更新其依赖包（递归升级）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--prerelease</span></code>：允许提前释放（暂不明白）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--unconstrained</span></code>：忽略包版本的约束，可将包升级至最新版本</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--top</span></code>：仅更新有在 pyproject.toml 的包</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--dry-run</span></code>：试运行，而不去修改 lock 文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--no-sync</span></code>：只更新 lock 文件，但不更新包</p></li>
</ul>
<p>如果你的依赖包有设置分组，还可以指定分组进行更新</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pdm<span class="w"> </span>update<span class="w"> </span>-G<span class="w"> </span>security<span class="w"> </span>-G<span class="w"> </span>http
</pre></div>
</div>
<p>也可以指定分组更新分组里的某个包</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pdm<span class="w"> </span>update<span class="w"> </span>-G<span class="w"> </span>security<span class="w"> </span>cryptography
</pre></div>
</div>
<p>再加个 <code class="docutils literal notranslate"><span class="pre">-d</span></code> 就可以再指定 dev 依赖</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 更新所有的 dev 依赖</span>
pdm<span class="w"> </span>update<span class="w"> </span>-d

<span class="c1"># 更新 dev 依赖下某个分组的某个包</span>
pdm<span class="w"> </span>update<span class="w"> </span>-dG<span class="w"> </span><span class="nb">test</span><span class="w"> </span>pytest
</pre></div>
</div>
<p>同样地，也可以指定 <code class="docutils literal notranslate"><span class="pre">--prod</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">--production</span></code> 升级非 dev
（即生产）的包。</p>
</section>
<section id="py">
<h3>4.8 切换 py<a class="headerlink" href="#py" title="此标题的永久链接">¶</a></h3>
<p>当你在初始化 pdm 项目时，就已经选定了当前的 Python 版本和可用的 Python
版本范围，后面如果想更改，可以使用 use
命令，但版本要受之前设定的版本范围约束。</p>
<p>假设允许范围是 python 3.9+，当前使用的是 python 3.10，可以直接切换过去。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pdm</span> <span class="n">use</span> <span class="n">python3</span><span class="mf">.9</span>
</pre></div>
</div>
</section>
</section>
<section id="id11">
<h2>5. 命令别名<a class="headerlink" href="#id11" title="此标题的永久链接">¶</a></h2>
<p>在 pyproject.toml 添加 <code class="docutils literal notranslate"><span class="pre">[tool.pdm.scripts]</span></code>
可以设置快捷命令别名，若项目的执行有非常多的参数，这种设定别名的方法将很有用。</p>
<img alt="http://image.iswbm.com/image-20220213001224815.png" src="http://image.iswbm.com/image-20220213001224815.png" />
<p><code class="docutils literal notranslate"><span class="pre">[tool.pdm.scripts]</span></code> 有两种形式</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 第一种</span>
<span class="k">[tool.pdm.scripts]</span>
<span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;python main.py&quot;</span>

<span class="c1"># 第一种</span>
<span class="k">[tool.pdm.scripts]</span>
<span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;python main.py&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>但若想在参数中加注释，就必须得使用第二种方法，例如这样</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pdm.scripts]</span>
<span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&quot;flask&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="c1"># Important comment here about always using port 54321</span>
<span class="w">    </span><span class="s">&quot;-p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;54321&quot;</span>
<span class="p">]}</span>
</pre></div>
</div>
<p>除了 cmd 之外，还有两个参数</p>
<p>一个是 shell 参数，从输出来看你应该和看出和 cmd 的区别，和
<code class="docutils literal notranslate"><span class="pre">subprocess.Popen()</span></code> with <code class="docutils literal notranslate"><span class="pre">shell=True</span></code> 差不多一个意思</p>
<img alt="http://image.iswbm.com/image-20220213003342952.png" src="http://image.iswbm.com/image-20220213003342952.png" />
<p>一个是 env_file 参数，可以指定配置环境变量的文件</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pdm.scripts]</span>
<span class="n">start</span><span class="p">.</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;flask run -p 54321&quot;</span>
<span class="n">start</span><span class="p">.</span><span class="n">env_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.env&quot;</span>
</pre></div>
</div>
<p>如果想要把这个环境变量的文件不仅限于某个命令，而是 pdm run
全局，可以这样配置</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pdm.scripts]</span>
<span class="n">_</span><span class="p">.</span><span class="n">env_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.env&quot;</span>
</pre></div>
</div>
<p>加 <code class="docutils literal notranslate"><span class="pre">--list</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">-l</span></code>可以查看所有设置的快捷别名</p>
<img alt="http://image.iswbm.com/image-20220213003948180.png" src="http://image.iswbm.com/image-20220213003948180.png" />
<p>对于每一个快捷命令，都可以设置 pre 和 post 命令：</p>
<ul class="simple">
<li><p>pre 命令：在每次快捷命令执行前会执行</p></li>
<li><p>post 命令：在每次快捷命令执行后会执行</p></li>
</ul>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pdm.scripts]</span>
<span class="n">pre_compress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{{ Run BEFORE the `compress` script }}&quot;</span>
<span class="n">compress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tar czvf compressed.tar.gz data/&quot;</span>
<span class="n">post_compress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{{ Run AFTER the `compress` script }}&quot;</span>
</pre></div>
</div>
</section>
<section id="id12">
<h2>6. 自动补全<a class="headerlink" href="#id12" title="此标题的永久链接">¶</a></h2>
<p>pdm
的命令虽多，但并不复杂，并不太需要使用自动补全，若你真的需要补全，也可以实现。</p>
<p>对于不同的
shell，自动补全的配置方式都不太一样，这个在官网上有详细的说明。</p>
<p>如果你和我一样使用的 zsh，可以参照我的配置方式。</p>
<img alt="http://image.iswbm.com/image-20220212214047051.png" src="http://image.iswbm.com/image-20220212214047051.png" />
<p>截图中间有一步是 vim ~/.zshrc ，是将 pdm 插件配置到 zsh 中</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span><span class="o">=</span><span class="p">(</span><span class="n">git</span> <span class="n">z</span> <span class="n">macos</span> <span class="n">extract</span> <span class="n">zsh</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">highlighting</span> <span class="n">zsh</span><span class="o">-</span><span class="n">autosuggestions</span> <span class="n">pdm</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id13">
<h2>7. 方案兼容<a class="headerlink" href="#id13" title="此标题的永久链接">¶</a></h2>
<section id="id14">
<h3>其他方案迁移到 pdm<a class="headerlink" href="#id14" title="此标题的永久链接">¶</a></h3>
<p>pdm 足够好用，也足够开放，如果你当前使用的是其他的包管理器，比如 pipenv
，poetry，或者还在用最原始的 requirements.txt ，你也可以很方便的迁移到
pdm 中来：</p>
<ul class="simple">
<li><p>使用 pdm import -f {file} 无需初始化，直接转换</p></li>
<li><p>执行 pdm init 或者 pdm install
的时候，会自动识别你当前的依赖情况并转换</p></li>
</ul>
</section>
<section id="id15">
<h3>pdm 迁移到其他方案<a class="headerlink" href="#id15" title="此标题的永久链接">¶</a></h3>
<p>同样的，你也可以当 pdm 管理的项目，导出为其他方案</p>
<p>pyproject.toml 和 pdm.lock是 pdm 的两个核心文件。</p>
<p>pdm 做为一个后起之秀，也没有忘记向前兼容，它支持：</p>
<ul>
<li><p>将 pyproject.toml 转成 setup.py</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pdm<span class="w"> </span><span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>setuppy<span class="w"> </span>-o<span class="w"> </span>setup.py
</pre></div>
</div>
</li>
<li><p>将 pdm.lock 转成 requirements.txt</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pdm<span class="w"> </span><span class="nb">export</span><span class="w"> </span>-o<span class="w"> </span>requirements.txt
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="id16">
<h2>8. 总结一下<a class="headerlink" href="#id16" title="此标题的永久链接">¶</a></h2>
<p>花了很大的力气，终于把 PDM
的基本用法给介绍完毕，相信一定会有人会提出质疑：这就是你所谓的
<strong>划时代的包管理器</strong> ？</p>
<p>实际上，上面仅仅是入门操作，而 PDM
的一些核心知识，考虑到篇幅有限，我将这些进阶类的内容安排在后续文章，它将包括但不仅限于：</p>
<ul class="simple">
<li><p>PDM 的原理剖析：PEP 582 提案</p></li>
<li><p>发布包的构建：PEP 517 提案</p></li>
<li><p>Hook 脚本的定义与使用</p></li>
<li><p>插件管理系统与自定义插件</p></li>
<li><p>缓存管理系统的介绍</p></li>
</ul>
<p>这些内容是 PDM 的核心，只有理解了这些，你才能真正用好
PDM，到那时你会感慨：<strong>为什么 Guido
还不把这样的工具收编成标准的包管理工具？</strong></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="c12_08.html" class="btn btn-neutral float-right" title="118 如何拒绝总是推荐私教课" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="c12_06.html" class="btn btn-neutral float-left" title="116 应对网络杠精的有效建议" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2023, 365堂说话之道 教你学说话口才训练 卢战卡.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>